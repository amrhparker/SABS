<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SALONIX - Login</title>
<link rel="stylesheet" href="style.css">

<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

</head>
<body>

<div class="auth-container">

    <div class="pink-overlay"></div>

    <img src="images/logo.png" class="logo">

    <img src="images/leftSide.png" class="illustration-left">

    <img src="images/rightSide.png" class="illustration-right">

    <div class="card-wrapper">
        <div class="card">

            <div class="header">
                <div class="header-top">
                    <div class="welcome-text">Welcome to SALONIX</div>
                    <div class="auth-link-section">
                        <p class="auth-question">No Account ?</p>
                        <a class="auth-link" href="customerRegister.html">Register</a>
                    </div>
                </div>
                <h1>Log In</h1>
                <br>
                <div class="role-options">
                    <label><input type="radio" name="role" value="customer" required> Customer</label>
                    <label><input type="radio" name="role" value="staff" required> Staff</label>
                    <label><input type="radio" name="role" value="admin" required> Admin</label>
                </div>
            </div>

            <form id="loginForm" class="auth-form" action="LoginServlet">
                <div class="form-group">
                    <label class="form-label">Enter your email address</label>
                    <input type="email" id="loginEmail" class="form-input" placeholder="Email Address" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Enter your password</label>
                    <div class="input-wrapper">
                        <input type="password" id="loginPassword" class="form-input password-input" placeholder="Password" required>
                        <button type="button" class="toggle-password" onclick="togglePassword('loginPassword')">üëÅ</button>
                    </div>
                </div>

                <button type="submit" class="submit-button">Log In</button>
            </form>
        </div>
    </div>
</div>
    
<!-- Success Modal -->
<div id="loginSuccessModal" class="modal-overlay">
    <div class="modal-content">
        <img src="images/successLogo.png" class="modal-icon-img">
        <div class="modal-body">
            <h2 class="modal-title">Welcome!</h2>
            <p class="modal-message">You have successfully logged in!</p>
            <button class="modal-button" onclick="closeModal('loginSuccessModal')">Okay</button>
        </div>
    </div>
</div>

<!-- Error Modal -->
<div id="loginErrorModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-body">
            <h2 class="modal-title">Login Failed</h2>
            <p class="modal-message">Invalid email or password!</p>
            <button class="modal-button" onclick="closeModal('loginErrorModal')">Okay</button>
        </div>
    </div>
</div>

<script>
function togglePassword(id){
    const input = document.getElementById(id);
    input.type = input.type === "password" ? "text" : "password";
}

// Open/Close modals
function openModal(id) {
    document.getElementById(id).style.display = 'flex';
}
function closeModal(id) {
    document.getElementById(id).style.display = 'none';
    if(id === 'loginSuccessModal'){
        const role = document.querySelector('input[name="role"]:checked').value;

        if(role === "customer") window.location.href = "customerDashboard.html";
        if(role === "staff") window.location.href = "staffDashboard.html";
        if(role === "admin") window.location.href = "adminDashboard.html";

    }
}

// Handle login
document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault(); // prevent form reload

    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    const role = document.querySelector('input[name="role"]:checked').value;

    // Send login data to server using fetch/AJAX
    fetch('LoginServlet', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: `email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}&role=${encodeURIComponent(role)}`
    })
    .then(res => res.text())
    .then(data =>{
        if(data === "success"){
            openModal('loginSuccessModal');  // show success popup
        } else {
            alert("‚ùå Incorrect email/password or role not found in database.");
        }
    })
    .catch(error => console.error('Error:', error));
});
</script>

</body>
</html>
